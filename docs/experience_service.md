# ExperienceService: Сервис управления опытом АМИ

## Назначение
ExperienceService является ключевым компонентом системы памяти АМИ, отвечающим за создание, обработку и управление опытом. Этот сервис реализует основную бизнес-логику для работы с воспоминаниями, обеспечивая согласованность и целостность данных.

## Основные возможности

### 1. Создание опыта
- Создание новых записей опыта различных типов (мысли, диалоги, наблюдения)
- Автоматическое связывание с контекстом и участниками
- Векторизация содержимого для семантического поиска
- Установка метаданных и служебной информации

### 2. Поиск и извлечение опыта
- Поиск по ID и базовым параметрам
- Семантический поиск по содержанию
- Фильтрация по типам, категориям и временным меткам
- Извлечение связанного опыта и цепочек мыслей

### 3. Управление связями
- Создание ассоциативных связей между опытом
- Построение иерархических отношений
- Управление контекстными связями
- Отслеживание причинно-следственных цепочек

### 4. Верификация и валидация
- Проверка целостности данных
- Валидация входных параметров
- Контроль качества векторных представлений
- Мониторинг состояния связей

## Взаимодействие с другими компонентами

### Зависимости
1. **VectorEncoder** - для создания векторных представлений
2. **ContextService** - для работы с контекстами
3. **ParticipantService** - для управления участниками
4. **SessionManager** - для управления транзакциями

### Интеграции
1. **MemoryQueryService** - для сложных запросов к памяти
2. **ThoughtService** - для работы с цепочками мыслей
3. **ResourceService** - для связи с внешними ресурсами

## Примеры использования

### 1. Создание нового опыта
```python
# Создание записи о диалоге
experience = experience_service.create_experience(
    content="Обсуждение природы сознания",
    experience_type=Experience.TYPE_DIALOGUE,
    information_category=Experience.CATEGORY_SELF,
    context_id=current_context.id,
    participants=[user, ami]
)
```

### 2. Поиск связанного опыта
```python
# Поиск семантически похожего опыта
related_experiences = experience_service.find_similar_experiences(
    experience_id=target_experience.id,
    min_similarity=0.7,
    limit=5
)
```

### 3. Создание ассоциативных связей
```python
# Связывание двух опытов
experience_service.create_association(
    source_id=experience1.id,
    target_id=experience2.id,
    association_type="semantic",
    strength=0.85
)
```

## Обработка ошибок

### Типы ошибок
1. **ExperienceNotFoundError** - опыт не найден
2. **InvalidExperienceDataError** - некорректные данные
3. **AssociationError** - ошибка создания связи
4. **ValidationError** - ошибка валидации

### Обработка исключений
```python
try:
    experience = experience_service.create_experience(...)
except InvalidExperienceDataError as e:
    logger.error(f"Ошибка создания опыта: {e}")
    # Обработка ошибки
```

## Рекомендации по использованию

### Лучшие практики
1. Всегда используйте транзакции при создании связанного опыта
2. Проверяйте существование контекста перед созданием опыта
3. Используйте пакетные операции для массовых изменений
4. Регулярно проверяйте целостность связей

### Оптимизация производительности
1. Используйте индексы для часто используемых запросов
2. Применяйте кэширование для повторяющихся операций
3. Группируйте связанные операции в одной транзакции
4. Используйте асинхронные операции где возможно

## Заключение
ExperienceService является центральным компонентом системы памяти АМИ, обеспечивающим надежное хранение и управление опытом. Правильное использование сервиса критически важно для формирования целостной и согласованной памяти АМИ.