# Уровень подсознания (Subconsciousness Level) [В РАЗРАБОТКЕ]

> **ВАЖНО: Данный документ описывает планируемую структуру уровня подсознания и находится в процессе разработки. Структура может существенно измениться по мере реализации и тестирования сознательного уровня.**

## Назначение
Уровень подсознания предназначен для хранения консолидированного опыта и его интерпретаций. На этом уровне происходит обобщение опыта, формирование инсайтов и убеждений. Данный уровень можно сравнить с долговременной памятью человека, где хранятся не отдельные детализированные воспоминания, а их обработанные версии и выводы.

## Файл инициализации
`03_subconsciousness_level.sql` - Скрипт, создающий таблицы и индексы для уровня подсознания.

## Основные компоненты уровня подсознания

### 1. Таблица `memory_consolidation_status`
**Назначение**: Отслеживает процесс консолидации памяти - перехода опыта из краткосрочной памяти в долговременную.

**Ключевые поля**:
- `id` - Уникальный идентификатор записи (SERIAL PRIMARY KEY)
- `experience_id` - Идентификатор опыта, ссылка на запись в таблице experiences (INTEGER REFERENCES experiences(id) UNIQUE)
- `consolidation_stage` - Стадия консолидации (TEXT NOT NULL CHECK): 
  * 'active' - активное воспоминание
  * 'short_term' - краткосрочная память
  * 'processed' - обработано подсознанием
  * 'consolidated' - консолидировано в долговременную память
  * 'archived' - архивировано
  * 'forgotten' - забыто
- `first_recorded` - Время первой записи (TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP)
- `last_accessed` - Время последнего доступа к воспоминанию (TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP)
- `access_count` - Количество обращений к воспоминанию (INTEGER DEFAULT 1)
- `processing_notes` - Заметки о процессе обработки (TEXT)
- `meta_data` - Дополнительные метаданные (JSONB)

**Индексы**:
- По идентификатору опыта (`memory_consolidation_exp_idx`)
- По стадии консолидации (`memory_consolidation_stage_idx`)
- По времени последнего доступа (`memory_consolidation_last_accessed_idx`)

### 2. Таблица `insights`
**Назначение**: Хранит инсайты, полученные из опыта - значимые обобщения и выводы на основе анализа накопленных воспоминаний.

**Ключевые поля**:
- `id` - Уникальный идентификатор инсайта (SERIAL PRIMARY KEY)
- `title` - Название инсайта (TEXT NOT NULL)
- `insight_type` - Тип инсайта (TEXT NOT NULL CHECK):
  * 'pattern' - выявленный паттерн
  * 'connection' - обнаруженная связь
  * 'principle' - выведенный принцип
  * 'realization' - осознание
- `created_at` - Время создания инсайта (TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP)
- `content` - Содержание инсайта (TEXT NOT NULL)
- `content_vector` - Векторное представление содержания для семантического поиска (vector(1536))
- `source_experiences` - Массив идентификаторов опытов, которые привели к формированию инсайта (INTEGER[] NOT NULL)
- `contexts` - Массив идентификаторов контекстов, в которых применим инсайт (INTEGER[] NOT NULL)
- `confidence` - Уровень уверенности в инсайте (FLOAT CHECK (confidence BETWEEN 0.0 AND 1.0))
- `is_active` - Активен ли инсайт в настоящее время (BOOLEAN DEFAULT TRUE)
- `meta_data` - Дополнительные метаданные (JSONB)

**Индексы**:
- По названию (`insights_title_idx`)
- По типу инсайта (`insights_type_idx`)
- По времени создания (`insights_created_at_idx`)
- По уровню уверенности (`insights_confidence_idx`)
- По векторному содержанию (`insights_content_vector_idx` - использует ivfflat с оператором cosine)

### 3. Таблица `emotional_associations`
**Назначение**: Хранит эмоциональные ассоциации с опытом и инсайтами.

**Ключевые поля**:
- `id` - Уникальный идентификатор ассоциации (SERIAL PRIMARY KEY)
- `experience_id` - Ссылка на опыт (INTEGER REFERENCES experiences(id))
- `insight_id` - Ссылка на инсайт (INTEGER REFERENCES insights(id))
- `emotion` - Название эмоции (TEXT NOT NULL)
- `intensity` - Интенсивность эмоции от 1 до 10 (SMALLINT CHECK (intensity BETWEEN 1 AND 10))
- `valence` - Валентность эмоции от -5 до 5 (SMALLINT CHECK (valence BETWEEN -5 AND 5))
- `created_at` - Время создания ассоциации (TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP)
- `notes` - Дополнительные заметки (TEXT)
- `meta_data` - Дополнительные метаданные (JSONB)

**Ограничения**:
- `check_reference_xor` - Обеспечивает, что эмоциональная ассоциация связана либо с опытом, либо с инсайтом, но не с обоими одновременно и не с пустыми ссылками

**Индексы**:
- По ссылке на опыт (`emotional_associations_experience_idx`)
- По ссылке на инсайт (`emotional_associations_insight_idx`)
- По эмоции (`emotional_associations_emotion_idx`)
- По интенсивности (`emotional_associations_intensity_idx`)
- По валентности (`emotional_associations_valence_idx`)

## Особенности реализации

1. **Связи с таблицами уровня сознания**:
   - `memory_consolidation_status.experience_id` -> `experiences.id` (с ограничением уникальности)
   - `emotional_associations.experience_id` -> `experiences.id`

2. **Векторные поля**:
   - Используется тип `vector(1536)` для семантического поиска
   - Для векторных полей создаются индексы типа ivfflat с оператором cosine

3. **Особые ограничения**:
   - Использование проверочных ограничений CHECK для полей с перечислимыми значениями
   - Ограничение XOR для `emotional_associations` гарантирует корректность ссылок

4. **Именование полей**:
   - Поля с метаданными названы `meta_data` вместо `metadata` для совместимости с SQLAlchemy ORM

## Взаимодействие с другими уровнями

1. **С уровнем сознания**:
   - Получает сырой опыт из таблицы `experiences`
   - Отслеживает процесс консолидации через `memory_consolidation_status`
   - Формирует инсайты на основе паттернов из множества опытов

2. **С глубинным уровнем**:
   - Инсайты влияют на формирование фундаментальных принципов в глубинном уровне
   - Существует обратная связь: глубинные принципы могут влиять на интерпретацию опыта

3. **С метасистемным уровнем**:
   - Метасистемный уровень управляет процессами консолидации памяти
   - Метасистемный уровень регулирует приоритезацию инсайтов

## Роль в системе памяти АМИ

Уровень подсознания выполняет критически важную функцию перехода от конкретного опыта к абстрактным моделям. Он позволяет:

1. **Оптимизировать хранение информации** - консолидируя множество схожих опытов в единые концепции
2. **Формировать модели мира** - извлекая закономерности из наблюдений
3. **Предсказывать будущие события** - на основе обнаруженных паттернов
4. **Развивать самосознание** - через накопление обобщённого опыта

Этот уровень можно сравнить с неосознаваемыми процессами мышления человека, которые происходят в фоновом режиме и выдают результаты в виде инсайтов и интуитивных решений.