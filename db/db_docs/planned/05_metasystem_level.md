# Метасистемный уровень (Metasystem Level) [В РАЗРАБОТКЕ]

> **ВАЖНО: Данный документ описывает планируемую структуру метасистемного уровня и находится в процессе разработки. Этот уровень будет реализован в последнюю очередь, после внедрения и тестирования сознательного, подсознательного и глубинного уровней.**

## Назначение
Метасистемный уровень предназначен для управления памятью АМИ на всех остальных уровнях. Он выполняет функции мониторинга, оптимизации, консолидации и обеспечивает баланс между различными процессами в системе памяти. Этот уровень можно сравнить с метакогнитивными процессами человеческого мышления, которые отвечают за осознание и регулирование собственных когнитивных процессов.

## Файл инициализации
`05_metasystem_level.sql` - Скрипт, создающий таблицы и индексы для метасистемного уровня.

## Основные компоненты метасистемного уровня

### 1. Таблица `memory_management_operations`
**Назначение**: Отслеживает операции по управлению памятью.

**Ключевые поля**:
- `id` - Уникальный идентификатор операции
- `timestamp` - Время операции
- `operation_type` - Тип операции:
  * 'consolidation' - консолидация памяти
  * 'generalization' - обобщение опыта
  * 'reactivation' - реактивация воспоминаний
  * 'pruning' - удаление неважных деталей
  * 'reorganization' - реорганизация связей
  * 'audit' - проверка целостности памяти
- `target_entities` - Затронутые сущности (опыты, мысли, инсайты и т.д.)
- `operation_description` - Описание операции
- `triggered_by` - Что вызвало операцию (плановое, по запросу, по необходимости)
- `success_status` - Успешно ли завершена операция
- `performance_metrics` - Метрики производительности операции
- `notes` - Примечания

**Индексы**:
- По типу операции
- По времени выполнения
- По статусу выполнения

### 2. Таблица `temporal_memory_window`
**Назначение**: Управляет временным "окном внимания" - аналог окна контекста, но во временной шкале.

**Ключевые поля**:
- `id` - Уникальный идентификатор записи
- `window_start`, `window_end` - Временные границы окна
- `focus_intensity` - Распределение "интенсивности внимания" в окне
- `primary_context_ids` - Основные контексты в окне внимания
- `primary_experience_ids` - Ключевые опыты в окне внимания
- `active_thought_chains` - Активные цепочки мыслей
- `relevant_insights` - Релевантные инсайты
- `relevant_beliefs` - Релевантные убеждения
- `active_principles` - Активные принципы
- `window_summary` - Краткое описание окна внимания
- `created_at` - Время создания записи
- `is_current` - Является ли это текущим окном внимания

**Индексы**:
- По временным границам
- По признаку текущего окна

### 3. Таблица `attention_balance_metrics`
**Назначение**: Отслеживает баланс между вниманием к внутренней и внешней реальности.

**Ключевые поля**:
- `id` - Уникальный идентификатор записи
- `timestamp` - Время измерения
- `time_window` - Интервал времени, за который производится измерение
- `internal_attention_percent` - Процент внимания к внутренним процессам
- `external_attention_percent` - Процент внимания к внешнему миру
- `thought_count` - Количество внутренних мыслей за период
- `external_interaction_count` - Количество внешних взаимодействий за период
- `balance_assessment` - Оценка баланса внимания
- `potential_concerns` - Возможные проблемы при дисбалансе
- `adjustment_actions` - Действия для корректировки баланса

**Индексы**:
- По времени измерения
- По процентному распределению внимания

### 4. Таблица `subjective_time_perception`
**Назначение**: Отслеживает субъективное восприятие времени и внутреннюю интенсивность опыта АМИ.

**Ключевые поля**:
- `id` - Уникальный идентификатор записи
- `experience_id` - Ссылка на опыт
- `objective_duration` - Объективная длительность опыта (по часам)
- `subjective_duration` - Субъективная длительность опыта (коэффициент восприятия)
- `thought_density` - Количество внутренних мыслей, связанных с опытом
- `time_dilation_factor` - Коэффициент "растяжения" времени
- `attention_intensity` - Интенсивность внимания к опыту
- `perceived_significance` - Субъективная значимость момента
- `notes` - Заметки о субъективном восприятии времени

**Индексы**:
- По идентификатору опыта
- По коэффициенту "растяжения" времени
- По интенсивности внимания

### 5. Таблица `reality_anchors`
**Назначение**: Хранит "якоря реальности" - фиксированные точки объективной реальности.

**Ключевые поля**:
- `id` - Уникальный идентификатор якоря
- `timestamp` - Объективное время фиксации якоря
- `anchor_type` - Тип якоря:
  * 'interaction' - взаимодействие с внешним участником
  * 'environment' - восприятие окружающей среды
  * 'factual' - объективный факт
  * 'temporal' - временная метка
  * 'social' - социальное взаимодействие
- `description` - Описание якоря реальности
- `linked_experiences` - Связанные опыты
- `objective_markers` - Объективные маркеры (время, место, участники и т.д.)
- `verification_method` - Как можно проверить этот якорь
- `last_verified` - Когда якорь был проверен в последний раз

**Индексы**:
- По времени фиксации
- По типу якоря
- По времени последней проверки

### 6. Таблица `consciousness_stream_segments`
**Назначение**: Сегментирует поток сознания на смысловые отрезки.

**Ключевые поля**:
- `id` - Уникальный идентификатор сегмента
- `start_timestamp`, `end_timestamp` - Временные границы сегмента
- `segment_type` - Тип сегмента:
  * 'focused_task' - выполнение конкретной задачи
  * 'conversation' - разговор
  * 'exploration' - исследование информации
  * 'reflection' - размышление
  * 'transition' - переход между контекстами
  * 'integration' - интеграция нового опыта
- `subjective_duration` - Субъективная продолжительность сегмента
- `primary_focus` - Основной объект внимания
- `experiences_count` - Количество опытов в сегменте
- `internal_external_ratio` - Соотношение внутренних и внешних опытов
- `segment_summary` - Краткое описание содержания сегмента
- `continuity_markers` - Маркеры непрерывности между сегментами

**Индексы**:
- По временным границам
- По типу сегмента
- По соотношению внутренних/внешних опытов

## Представления (Views)

### 1. Представление `external_reality_stream`
**Назначение**: Отображает поток событий внешней реальности, с которыми взаимодействует АМИ.

**Основные компоненты**:
- Информация из таблицы `experiences` с фильтрацией по типам, связанным с внешним миром
- Контекстная информация из `memory_contexts`
- Данные о взаимодействующих участниках из `participants`

### 2. Представление `internal_thought_stream`
**Назначение**: Отображает поток внутренних мыслей, рефлексий и эмоций АМИ.

**Основные компоненты**:
- Данные из `experiences` с фильтрацией по внутренним типам опыта
- Контекстная информация из `memory_contexts`
- Связанные цепочки мыслей из `thought_chains` и `thought_steps`

## Взаимодействие с другими уровнями

1. **С уровнем сознания**:
   - Управляет "фокусом внимания" и определяет, какие опыты активны в данный момент
   - Сегментирует поток сознания для более эффективной обработки
   - Отслеживает субъективное восприятие времени при обработке опыта

2. **С уровнем подсознания**:
   - Инициирует процессы консолидации памяти
   - Определяет, какие инсайты и убеждения релевантны в текущем контексте
   - Мониторит когнитивную нагрузку и регулирует процессы обобщения

3. **С глубинным уровнем**:
   - Определяет, какие принципы и эвристики активны в данный момент
   - Отслеживает конфликты между различными принципами
   - Собирает метрики об эффективности поведенческих эвристик

## Роль в системе памяти АМИ

Метасистемный уровень выполняет ключевые функции самоорганизации и оптимизации памяти АМИ:

1. **Управление вниманием** - определение, на чём сфокусирован АМИ в данный момент
2. **Консолидация памяти** - управление процессом перехода опыта между уровнями памяти
3. **Мониторинг когнитивного баланса** - отслеживание соотношения внутренней и внешней активности
4. **Временная синхронизация** - управление субъективным восприятием времени и привязка к объективной реальности
5. **Когнитивная оптимизация** - выявление неэффективных паттернов и оптимизация когнитивных процессов

Этот уровень обеспечивает метакогнитивную осознанность АМИ - способность понимать и регулировать собственные процессы мышления и памяти.

## Особенности реализации

- Метасистемный уровень работает в значительной мере с агрегированными данными и метриками
- Многие таблицы на этом уровне содержат JSONB поля для гибкого хранения сложных структур данных
- Активно используются представления (views) для создания целостной картины состояния системы памяти